---
layout: post
title:  我的Shell笔记
date: 2021-02-25
tags: 博客
---

不断更新，逐渐完善！

### 保存近n天的数据
	
	# 寻找bat文件夹下，名字符合开头是20的文件(夹)，删除7天前的文件
	find ./bat -mtime +7 -name "20*" -exec rm -rf {} \;

### 读取json文件
	# 读取config.json文件中key为data_keep_days对应的value
	data_keep_days=$(cat config.json | grep -Po 'data_keep_days[" :]+\K[^"]+')
	
### 删除指定路径下符合._*的文件

	# macOS系统会产生这种文件，为了避免在macOS文件传输到linux系统后出现问题
	find ./bat -type f -name '._*' -delete

### 判断文件是否存在 -f

	if [[ ! -f "$testFile" ]]; then
		echo "文件不存在"
	else
		echo "文件存在"
	fi
	
### 判断文件夹是否存在 -d

	if [[ ! -d "$testPath" ]]; then
		echo "文件夹不存在"
	else
		echo "文件夹存在"
	fi

### 获取文件当前所在目录的绝对路径
	
	# 将此行代码加入脚本文件，$0即为此行代码所在文件的文件名，会自动识别
	master=$(cd `dirname $0`; pwd)

### crontab执行shell脚本带日期参数时记得用`\%`代替`%`

	# 示例
	10 6 * * * (sh run.sh $(date +"\%Y-\%m-\%d" -d "-1 day") >> my.log 2>&1)
	
	
###  expect多行命令与单行命令

	# expect多行命令
	/usr/bin/expect  << EOF
	set timeout 1200
	spawn scp '$mySource' '$myTarget'
	expect "*assword:"
	send "$mypasswd\n"
	EOF
	
	# expect单行命令

	/usr/bin/expect  -c  'set timeout 1200; spawn scp '$mySource' '$myTarget'; expect "*assword:"; send "'$mypasswd'\n"; expect eof'
	
### hadoop .gz文件解压然后做欠采样，正负样本比1:20->1:1

	hadoop fs -cat gzip_data_path | gzip -d | awk -F'\t' '{a[$1]++;if($1==1 || a[$1]%20==0 && $1==0) print $0}'
	
### 全局替换文件字段
	
	用newname替换oldname
	sed -i "s?oldname?newname?g" test.py
	
### 日期变更
	保持字符串原有格式，进行日期加减
	last_date="20210318/03"
	cur_date=$(date +%Y%m%d/%H -d "$(echo $batch_begin | sed 's/\// /') +1 hour")
	
### shell字符串截取

	正向截取k个
	${mystr:0:k}
	反向截取k个
	${mystr:0-k}